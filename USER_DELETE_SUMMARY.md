# ููุฎุต ุฅุถุงูุฉ ุตูุงุญูุฉ ุญุฐู ุงููุณุชุฎุฏููู

## โ ูุง ุชู ุฅูุฌุงุฒู

### 1. ุฅุถุงูุฉ Route ุงูุญุฐู
- **ุงูููู**: `app/auth/routes.py`
- **ุงููุธููุฉ**: `delete_user(user_id)`
- **ุงููุณุงุฑ**: `/auth/delete_user/<int:user_id>`
- **ุงูุทุฑููุฉ**: POST ููุท

### 2. ุถูุงุจุท ุงูุฃูุงู ุงููุทุจูุฉ
- โ **ุตูุงุญูุฉ ุงููุฏูุฑ ููุท**: ุงูุชุญูู ูู `current_user.role == 'admin'`
- โ **ููุน ุญุฐู ุงูุฐุงุช**: `user_to_delete.id != current_user.id`
- โ **ุงูุชุญูู ูู ุงููุถุงูุง**: ููุน ุญุฐู ูุณุชุฎุฏู ูู ูุถุงูุง ูุฑุชุจุทุฉ
- โ **ุงูุชุญูู ูู ุงูููุงุนูุฏ**: ููุน ุญุฐู ูุณุชุฎุฏู ูู ููุงุนูุฏ ูุฑุชุจุทุฉ
- โ **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก**: try/catch ูุน rollback

### 3. ุชุญุฏูุซ ูุงุฌูุฉ ุงููุณุชุฎุฏู
- **ุงูููู**: `app/templates/auth/users.html`
- โ ุฅุถุงูุฉ ุฒุฑ ุญุฐู (ุฃููููุฉ ุณูุฉ ุงูููููุงุช)
- โ ุฅุฎูุงุก ุงูุฒุฑ ูููุณุชุฎุฏู ุงูุญุงูู
- โ JavaScript ููุชุฃููุฏ ูุจู ุงูุญุฐู
- โ ุฅุฑุณุงู CSRF token ูุน ุงูุทูุจ

### 4. ุชุญุณูู ุงูุฃูุงู
- **ุงูููู**: `app/__init__.py`
- โ ุฅุถุงูุฉ CSRFProtect
- **ุงูููู**: `app/templates/base.html`
- โ ุฅุถุงูุฉ CSRF token ูู meta tag

## ๐ง ุงูููุฏ ุงููุถุงู

### Route ุงูุญุฐู
```python
@bp.route('/delete_user/<int:user_id>', methods=['POST'])
@login_required
def delete_user(user_id):
    # ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
    if current_user.role != 'admin':
        flash('ููุณ ูุฏูู ุตูุงุญูุฉ ูุญุฐู ุงููุณุชุฎุฏููู', 'danger')
        return redirect(url_for('auth.users'))
    
    # ููุน ุญุฐู ุงูุฐุงุช
    user_to_delete = User.query.get_or_404(user_id)
    if user_to_delete.id == current_user.id:
        flash('ูุง ููููู ุญุฐู ุญุณุงุจู ุงูุฎุงุต', 'danger')
        return redirect(url_for('auth.users'))
    
    # ุงูุชุญูู ูู ุงูุงุฑุชุจุงุทุงุช
    if user_to_delete.cases.count() > 0:
        flash(f'ูุง ูููู ุญุฐู ุงููุณุชุฎุฏู {user_to_delete.full_name} ูุฃูู ูุฑุชุจุท ุจูุถุงูุง ููุฌูุฏุฉ', 'danger')
        return redirect(url_for('auth.users'))
    
    if user_to_delete.appointments.count() > 0:
        flash(f'ูุง ูููู ุญุฐู ุงููุณุชุฎุฏู {user_to_delete.full_name} ูุฃูู ูุฑุชุจุท ุจููุงุนูุฏ ููุฌูุฏุฉ', 'danger')
        return redirect(url_for('auth.users'))
    
    # ุงูุญุฐู ุงูุขูู
    try:
        user_name = user_to_delete.full_name
        db.session.delete(user_to_delete)
        db.session.commit()
        flash(f'ุชู ุญุฐู ุงููุณุชุฎุฏู {user_name} ุจูุฌุงุญ', 'success')
    except Exception as e:
        db.session.rollback()
        flash('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญุฐู ุงููุณุชุฎุฏู', 'danger')
    
    return redirect(url_for('auth.users'))
```

### ุฒุฑ ุงูุญุฐู ูู HTML
```html
<button class="btn btn-outline-danger" 
        onclick="deleteUser({{ user.id }}, '{{ user.full_name }}')"
        title="ุญุฐู ุงููุณุชุฎุฏู">
    <i class="fas fa-trash"></i>
</button>
```

### JavaScript ููุชุฃููุฏ
```javascript
function deleteUser(userId, userName) {
    if (confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงููุณุชุฎุฏู "${userName}"ุ\n\nุชุญุฐูุฑ: ูุฐุง ุงูุฅุฌุฑุงุก ูุง ูููู ุงูุชุฑุงุฌุน ุนูู!`)) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/auth/delete_user/${userId}`;
        
        const csrfToken = document.querySelector('meta[name=csrf-token]');
        if (csrfToken) {
            const csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrf_token';
            csrfInput.value = csrfToken.getAttribute('content');
            form.appendChild(csrfInput);
        }
        
        document.body.appendChild(form);
        form.submit();
    }
}
```

## ๐งช ุงูุงุฎุชุจุงุฑ
- โ ุชู ุฅูุดุงุก ููู ุงุฎุชุจุงุฑ `simple_test.py`
- โ ุชู ุงูุชุญูู ูู ุงููุธููุฉ ุงูุฃุณุงุณูุฉ
- โ ุชู ุงุฎุชุจุงุฑ ุงูุญุฐู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

1. **ุชุณุฌูู ุงูุฏุฎูู ููุฏูุฑ**
2. **ุงูุงูุชูุงู ุฅูู "ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู"**
3. **ุงูุนุซูุฑ ุนูู ุงููุณุชุฎุฏู ุงููุฑุงุฏ ุญุฐูู**
4. **ุงูููุฑ ุนูู ุฒุฑ ุงูุญุฐู (๐๏ธ)**
5. **ุชุฃููุฏ ุงูุนูููุฉ ูู ุงููุงูุฐุฉ ุงูููุจุซูุฉ**

## โ๏ธ ุงููููุฏ ูุงูุชุญุฐูุฑุงุช

### ูุง ูููู ุญุฐู ูุณุชุฎุฏู ูู ุงูุญุงูุงุช ุงูุชุงููุฉ:
- โ ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ุงูุญุงูู ููุณ ูุฏูุฑุงู
- โ ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุญุงูู ุญุฐู ููุณู
- โ ุฅุฐุง ูุงู ูููุณุชุฎุฏู ูุถุงูุง ูุฑุชุจุทุฉ
- โ ุฅุฐุง ูุงู ูููุณุชุฎุฏู ููุงุนูุฏ ูุฑุชุจุทุฉ

### ุชุญุฐูุฑุงุช ูููุฉ:
- ๐จ **ุงูุญุฐู ููุงุฆู** - ูุง ูููู ุงูุชุฑุงุฌุน ุนูู
- ๐จ **ุชุฃูุฏ ูู ุงููุณุฎ ุงูุงุญุชูุงุทู** ูุจู ุงูุญุฐู
- ๐จ **ุฑุงุฌุน ุงูุงุฑุชุจุงุทุงุช** ูุจู ูุญุงููุฉ ุงูุญุฐู

## ๐ ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ ุงูููุชุฑุญุฉ

1. **ุฅูุบุงุก ุงูุชูุนูู ุจุฏูุงู ูู ุงูุญุฐู**
   - ุฅุถุงูุฉ ุญูู `is_deleted` ุฃู `deleted_at`
   - ุฅุฎูุงุก ุงููุณุชุฎุฏููู ุงููุญุฐูููู ุจุฏูุงู ูู ุญุฐููู ููุงุฆูุงู

2. **ููู ุงูุจูุงูุงุช**
   - ุฅููุงููุฉ ููู ุงููุถุงูุง ูุงูููุงุนูุฏ ุฅูู ูุณุชุฎุฏู ุขุฎุฑ
   - ูุนุงูุฌ ูููู ุงูุจูุงูุงุช ูุจู ุงูุญุฐู

3. **ุณุฌู ุงูุนูููุงุช**
   - ุชุณุฌูู ุนูููุงุช ุงูุญุฐู ูู ุฌุฏูู ูููุตู
   - ุชุชุจุน ูู ูุงู ุจุงูุญุฐู ููุชู

4. **ุชุฃููุฏ ุฅุถุงูู**
   - ุทูุจ ูููุฉ ูุฑูุฑ ุงููุฏูุฑ ููุชุฃููุฏ
   - ุฅุฑุณุงู ุฅูููู ุชุฃููุฏ ูุจู ุงูุญุฐู

## ๐ฏ ุงูุฎูุงุตุฉ
ุชู ุจูุฌุงุญ ุฅุถุงูุฉ ููุฒุฉ ุญุฐู ุงููุณุชุฎุฏููู ูุน ุถูุงุจุท ุฃูุงู ุตุงุฑูุฉ ููุงุฌูุฉ ูุณุชุฎุฏู ุณููุฉ ุงูุงุณุชุฎุฏุงู. ุงูููุฒุฉ ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู ูู ุงูุจูุฆุฉ ุงูุฅูุชุงุฌูุฉ.
