#!/usr/bin/env python3
"""
WSGI Entry Point for Law Office Management System
Ù†Ù‚Ø·Ø© Ø¯Ø®ÙˆÙ„ WSGI Ù„Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø­Ø§Ù…Ø§Ø©

Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„Ø§Ø³ØªØ¶Ø§ÙØ§Øª Ø§Ù„ØªÙŠ ØªØ¯Ø¹Ù… Python Ù…Ø«Ù„:
- Heroku
- Railway
- PythonAnywhere
- DigitalOcean App Platform
"""

import os
import sys

# Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ù…Ø³Ø§Ø±
current_dir = os.path.dirname(os.path.abspath(__file__))
sys.path.insert(0, current_dir)

# Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
try:
    from final_working import app
    print("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­")
except ImportError as e:
    print(f"âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚: {e}")
    # Ø¥Ù†Ø´Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø¯ÙŠÙ„ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
    from flask import Flask
    app = Flask(__name__)
    
    @app.route('/')
    def error_page():
        return '''
        <html dir="rtl">
        <head>
            <meta charset="utf-8">
            <title>Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</title>
            <style>
                body { font-family: Arial; text-align: center; padding: 50px; }
                .error { color: red; background: #ffe6e6; padding: 20px; border-radius: 10px; }
            </style>
        </head>
        <body>
            <h1>ğŸš¨ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</h1>
            <div class="error">
                <p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„Ù final_working.py</p>
                <p>ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</p>
            </div>
        </body>
        </html>
        '''

# Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
try:
    with app.app_context():
        from final_working import db, User
        db.create_all()
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯
        if User.query.count() == 0:
            admin = User(username='admin', first_name='Ù…Ø¯ÙŠØ±', last_name='Ø§Ù„Ù†Ø¸Ø§Ù…')
            admin.set_password('admin123')
            db.session.add(admin)
            db.session.commit()
            print("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ")
except Exception as e:
    print(f"âš ï¸ ØªØ­Ø°ÙŠØ± ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: {e}")

# ØªØµØ¯ÙŠØ± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ù„Ù€ WSGI server
application = app

if __name__ == "__main__":
    # Ù„Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ù„ÙŠ
    port = int(os.environ.get('PORT', 8080))
    host = os.environ.get('HOST', '0.0.0.0')
    debug = os.environ.get('DEBUG', 'False').lower() == 'true'
    
    print("="*50)
    print("ğŸš€ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø­Ø§Ù…Ø§Ø©")
    print("ğŸ“§ Ø§Ù„Ù…Ø­Ø§Ù…ÙŠ ÙØ§Ù„Ø­ Ø¨Ù† Ø¹Ù‚Ø§Ø¨ Ø¢Ù„ Ø¹ÙŠØ³Ù‰")
    print("="*50)
    print(f"ğŸŒ Ø§Ù„Ø®Ø§Ø¯Ù…: http://{host}:{port}")
    print("ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: admin")
    print("ğŸ”‘ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: admin123")
    print("="*50)
    
    app.run(host=host, port=port, debug=debug)
